<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Source Code Aggregator with Documentation Generation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="app">
        <header>
            <div class="header-content">
                <h1><i class="fas fa-code"></i> Source Code Aggregator</h1>
                <p>Analyze directories, select source code files, and compress them into markdown format</p>
            </div>
        </header>

        <div class="container">
            <div class="step-section" id="step1">
                <h2><span class="step-number">1</span> Select Directory</h2>
                <div class="input-group">
                    <input type="text" id="directoryPath" placeholder="/path/to/your/project" value=".">
                    <button id="analyzeBtn" class="btn btn-primary">
                        <i class="fas fa-search"></i> Analyze
                    </button>
                </div>
                <div id="analyzeStatus" class="status-message"></div>
            </div>

            <div class="step-section" id="step2" style="display: none;">
                <h2><span class="step-number">2</span> Select Files</h2>

                <div class="search-panel">
                    <div class="search-group">
                        <input type="text" id="searchInput" placeholder="Search files... (Ctrl+F)" class="search-input">
                        <button id="searchBtn" class="btn btn-sm btn-primary">
                            <i class="fas fa-search"></i> Search
                        </button>
                        <button id="clearSearchBtn" class="btn btn-sm btn-danger">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                    <div id="searchResultsSection" style="display: none;" class="search-results-info">
                        <i class="fas fa-info-circle"></i>
                        <span id="searchResultCount"></span>
                    </div>
                </div>

                <div class="bulk-select-panel">
                    <h4><i class="fas fa-list"></i> Bulk Selection by Filename</h4>
                    <div class="bulk-select-group">
                        <textarea id="bulkSelectInput" placeholder="Enter filenames (one per line or comma-separated)&#10;Examples:&#10;app.py&#10;config.json&#10;utils/helper.js" rows="4"></textarea>
                        <button id="bulkSelectBtn" class="btn btn-success">
                            <i class="fas fa-check-double"></i> Select
                        </button>
                    </div>
                </div>

                <div class="ai-select-panel">
                    <h4><i class="fas fa-robot"></i> AI-based Smart File Selection</h4>
                    <p class="ai-description">
                        Describe the files you want in natural language, and AI will automatically find and select related files.
                    </p>
                    <div class="ai-select-group">
                        <textarea
                            id="aiQueryInput"
                            placeholder="Examples:&#10;- Find all code related to file transfer&#10;- User authentication handling files&#10;- Files with API endpoints defined&#10;- Database schema files"
                            rows="3"
                        ></textarea>
                        <button id="aiSelectBtn" class="btn btn-primary">
                            <i class="fas fa-magic"></i> AI File Selection
                        </button>
                    </div>
                    <div class="ai-tips">
                        <i class="fas fa-info-circle"></i>
                        <strong>Tip:</strong> More specific descriptions yield more accurate results.
                    </div>
                </div>

                <div id="aiResultsSection" class="ai-results-section" style="display: none;">
                    <div id="aiResultsContent"></div>
                </div>
                
                <div class="control-panel">
                    <div class="control-group">
                        <button id="expandAllBtn" class="btn btn-sm">
                            <i class="fas fa-expand"></i> Expand All
                        </button>
                        <button id="collapseAllBtn" class="btn btn-sm">
                            <i class="fas fa-compress"></i> Collapse All
                        </button>
                    </div>
                    <div class="control-group">
                        <label>Extension Filter:</label>
                        <select id="extensionFilter" multiple>
                            <option value="all">All Extensions</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <button id="selectAllBtn" class="btn btn-sm btn-success">
                            <i class="fas fa-check-square"></i> Select All
                        </button>
                        <button id="deselectAllBtn" class="btn btn-sm btn-danger">
                            <i class="fas fa-square"></i> Deselect All
                        </button>
                    </div>
                </div>

                <div class="main-content">
                    <div class="file-tree-container">
                        <h3><i class="fas fa-folder-tree"></i> Directory Structure</h3>
                        <div id="fileTree" class="file-tree"></div>
                    </div>

                    <div class="stats-panel">
                        <h3><i class="fas fa-chart-pie"></i> Statistics</h3>
                        
                        <div class="stat-card">
                            <h4>Overall Status</h4>
                            <div class="stat-item">
                                <span>Total Files:</span>
                                <strong id="totalFiles">0</strong>
                            </div>
                            <div class="stat-item">
                                <span>Total Directories:</span>
                                <strong id="totalDirs">0</strong>
                            </div>
                        </div>

                        <div class="stat-card">
                            <h4>Selection Status</h4>
                            <div class="stat-item">
                                <span>Selected Directories:</span>
                                <strong id="selectedDirs">0</strong>
                            </div>
                            <div class="stat-item">
                                <span>Selected Files:</span>
                                <strong id="selectedFiles">0</strong>
                            </div>
                            <div class="stat-item">
                                <span>Selected Size:</span>
                                <strong id="selectedSize">0 B</strong>
                            </div>
                        </div>

                        <div class="stat-card">
                            <h4>Distribution by Extension</h4>
                            <div id="extensionStats" class="extension-stats"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="analysis-tools">
                <h3><i class="fas fa-tools"></i> Advanced Analysis Tools</h3>

                <div class="tool-cards">
                    <div class="tool-card">
                        <div class="tool-icon">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <h4>Dependency Analysis</h4>
                        <p>Analyze dependency relationships of selected files and find missing files.</p>
                        <button id="analyzeDepsBtn" class="btn btn-primary">
                            <i class="fas fa-search"></i> Start Dependency Analysis
                        </button>
                    </div>

                  </div>
            </div>

  
            <div id="dependencyResults" class="dependency-results" style="display: none;">
                <div id="dependencyResultsContent"></div>
            </div>

            <div class="step-section" id="step3" style="display: none;">
                <h2><span class="step-number">3</span> Markdown Generation and Compression</h2>
                
                <div class="compression-options">
                    <h3><i class="fas fa-compress-alt"></i> Select Compression Options</h3>
                    <div class="compression-cards">
                        <div class="compression-card" data-type="none">
                            <input type="radio" name="compressionType" id="compressionNone" value="none" checked>
                            <label for="compressionNone">
                                <div class="card-header">
                                    <i class="fas fa-file-code"></i>
                                    <h4>No Compression</h4>
                                </div>
                                <div class="card-body">
                                    <p><strong>Original Markdown File</strong></p>
                                    <ul>
                                        <li>✅ Perfect preservation of all code</li>
                                        <li>✅ Immediately usable</li>
                                        <li>❌ Large file size</li>
                                        <li>❌ High AI token consumption</li>
                                    </ul>
                                    <div class="card-footer">
                                        <span class="badge">Recommended: Small projects</span>
                                    </div>
                                </div>
                            </label>
                        </div>

                        <div class="compression-card" data-type="semantic">
                            <input type="radio" name="compressionType" id="compressionSemantic" value="semantic">
                            <label for="compressionSemantic">
                                <div class="card-header">
                                    <i class="fas fa-brain"></i>
                                    <h4>Semantic Compression (Lossy)</h4>
                                </div>
                                <div class="card-body">
                                    <p><strong>Structure Summary JSON</strong></p>
                                    <ul>
                                        <li>✅ 67% token reduction</li>
                                        <li>✅ Optimized for AI analysis</li>
                                        <li>✅ Quick understanding possible</li>
                                        <li>❌ Original cannot be restored</li>
                                    </ul>
                                    <div class="card-footer">
                                        <span class="badge badge-success">Recommended: Code analysis/review</span>
                                    </div>
                                </div>
                            </label>
                        </div>

                        <div class="compression-card" data-type="lossless">
                            <input type="radio" name="compressionType" id="compressionLossless" value="lossless">
                            <label for="compressionLossless">
                                <div class="card-header">
                                    <i class="fas fa-file-archive"></i>
                                    <h4>Lossless Compression</h4>
                                </div>
                                <div class="card-body">
                                    <p><strong>GZIP + Base64</strong></p>
                                    <ul>
                                        <li>✅ 100% original restoration</li>
                                        <li>✅ 75% file size reduction</li>
                                        <li>❌ AI cannot read directly</li>
                                        <li>❌ Decompression required</li>
                                    </ul>
                                    <div class="card-footer">
                                        <span class="badge badge-info">Recommended: Archiving</span>
                                    </div>
                                </div>
                            </label>
                        </div>

                        <div class="compression-card" data-type="hybrid">
                            <input type="radio" name="compressionType" id="compressionHybrid" value="hybrid">
                            <label for="compressionHybrid">
                                <div class="card-header">
                                    <i class="fas fa-layer-group"></i>
                                    <h4>Hybrid</h4>
                                </div>
                                <div class="card-body">
                                    <p><strong>Structure Summary + Original Reference</strong></p>
                                    <ul>
                                        <li>✅ Structure analysis possible</li>
                                        <li>✅ Access original when needed</li>
                                        <li>✅ Token efficient</li>
                                        <li>⚠️ Original file stored separately</li>
                                    </ul>
                                    <div class="card-footer">
                                        <span class="badge badge-warning">Recommended: Large projects</span>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="selected-summary">
                    <p><i class="fas fa-info-circle"></i> <span id="selectedSummary">0 files have been selected.</span></p>
                </div>

                <div class="action-buttons">
                    <button id="generateBtn" class="btn btn-primary btn-lg">
                        <i class="fas fa-file-code"></i> Generate
                    </button>
                </div>

                <div id="generateStatus" class="status-message"></div>
                
                <div id="downloadSection" style="display: none;" class="download-section">
                    <h3>✅ Generation Complete!</h3>
                    <p id="downloadMessage">File has been successfully generated.</p>
                    <div id="compressionStats" class="compression-stats"></div>
                    <div class="download-buttons">
                        <a id="downloadBtn" class="btn btn-success btn-lg" href="#" download>
                            <i class="fas fa-download"></i> Download
                        </a>
                        <button id="decompressBtn" class="btn btn-info btn-lg" style="display: none;">
                            <i class="fas fa-expand-arrows-alt"></i> Decompress
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="previewModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="previewTitle">File Preview</h3>
                    <button class="modal-close" onclick="closePreview()">&times;</button>
                </div>
                <div class="modal-body">
                    <pre id="previewContent"></pre>
                </div>
            </div>
        </div>

        <div id="decompressModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Decompressed Original Code</h3>
                    <button class="modal-close" onclick="closeDecompressModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <pre id="decompressedContent"></pre>
                </div>
                <div class="modal-footer">
                    <button id="copyDecompressedBtn" class="btn btn-primary">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                    <button id="downloadDecompressedBtn" class="btn btn-success">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
            </div>
        </div>

        <div id="documentationModal" class="modal" style="display: none;">
            <div class="modal-content doc-modal">
                <div class="modal-header">
                    <h3><i class="fas fa-file-alt"></i> Select Documentation Type</h3>
                    <button class="modal-close" onclick="closeDocumentationModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- Language Selection -->
                    <div class="language-selection">
                        <h3><i class="fas fa-globe"></i> Language Selection</h3>
                        <div class="language-grid">
                            <div class="language-select-group">
                                <label for="languageSelect">Language:</label>
                                <select id="languageSelect" class="language-select">
                                    <option value="en" selected>English</option>
                                    <option value="zh">中文 (Chinese)</option>
                                    <option value="ja">日本語 (Japanese)</option>
                                    <option value="ar">العربية (Arabic)</option>
                                    <option value="es">Español (Spanish)</option>
                                    <option value="de">Deutsch (German)</option>
                                    <option value="ru">Русский (Russian)</option>
                                    <option value="custom">-- Custom --</option>
                                </select>
                            </div>
                            <div class="custom-language-input" id="customLanguageInput" style="display: none;">
                                <label for="customLanguageCode">Language Code:</label>
                                <input type="text" id="customLanguageCode" placeholder="e.g: fr, it, pt" maxlength="5">
                                <button id="applyCustomLanguage" class="btn btn-sm btn-primary">Apply</button>
                                <small>Enter ISO 639-1 language code (e.g: fr, it, pt)</small>
                            </div>
                        </div>
                   </div>

                </div>
            </div>
        </div>

  
        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
            <div class="spinner"></div>
            <p>Processing...</p>
        </div>
    </div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
